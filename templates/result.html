{% extends "base.html" %}

{% block title %}Meeting Notes - VoiceNotes AI{% endblock %}

{% block content %}
<div class="result-section">
    <h2>
        <span>&#x2705;</span>
        <span>Your Meeting Notes</span>
    </h2>

    <div class="transcript">
        <h3>&#x1F4DD; Transcript</h3>
        <p>{{ transcript or "Transcript not available" }}</p>
    </div>

    <div class="notes">
        <h3>&#x2728; AI-Generated Summary</h3>
        <div id="summaryContent">{{ summary or "Summary not available" }}</div>
    </div>

    <!-- Translation Options -->
    <div class="translation-section">
        <h3>&#x1F30D; Translate Notes</h3>
        <div class="translation-controls">
            <select id="targetLanguage" class="language-select">
                <option value="">Select Language...</option>
                <option value="Spanish">ğŸ‡ªğŸ‡¸ Spanish</option>
                <option value="French">ğŸ‡«ğŸ‡· French</option>
                <option value="German">ğŸ‡©ğŸ‡ª German</option>
                <option value="Arabic">ğŸ‡¸ğŸ‡¦ Arabic</option>
                <option value="Chinese">ğŸ‡¨ğŸ‡³ Chinese</option>
                <option value="Japanese">ğŸ‡¯ğŸ‡µ Japanese</option>
                <option value="Korean">ğŸ‡°ğŸ‡· Korean</option>
                <option value="Portuguese">ğŸ‡µğŸ‡¹ Portuguese</option>
                <option value="Russian">ğŸ‡·ğŸ‡º Russian</option>
                <option value="Italian">ğŸ‡®ğŸ‡¹ Italian</option>
                <option value="Hindi">ğŸ‡®ğŸ‡³ Hindi</option>
                <option value="Turkish">ğŸ‡¹ğŸ‡· Turkish</option>
            </select>
            <button class="btn btn-translate" onclick="translateNotes()" id="translateBtn">
                <span>ğŸŒ</span>
                <span>Translate</span>
            </button>
        </div>
        <div id="translationResult" class="translation-result" style="display:none;">
            <h4>Translated Summary:</h4>
            <div id="translatedContent"></div>
        </div>
    </div>

    <!-- Export Options -->
    <div class="export-options">
        <button class="btn btn-export export-btn" onclick="exportAsText()">
            <span>&#x1F4E5;</span>
            <span>Export as TXT</span>
        </button>
        <button class="btn btn-export export-btn" onclick="exportAsMarkdown()">
            <span>&#x1F4C4;</span>
            <span>Export as Markdown</span>
        </button>
        <button class="btn btn-secondary export-btn" onclick="copyToClipboard()">
            <span>&#x1F4CB;</span>
            <span>Copy to Clipboard</span>
        </button>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <a href="/" class="btn">
            <span>&#x2B06;</span>
            <span>Upload Another File</span>
        </a>
        <a href="/history" class="btn btn-secondary">
            <span>&#x1F4C2;</span>
            <span>View History</span>
        </a>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    // Translate Notes
    async function translateNotes() {
        const select = document.getElementById('targetLanguage');
        const targetLanguage = select.value;

        if (!targetLanguage) {
            showToast('Language Required', 'Please select a target language', 'warning');
            return;
        }

        const summary = document.getElementById('summaryContent').textContent;
        const btn = document.getElementById('translateBtn');
        const originalHTML = btn.innerHTML;

        try {
            // Show loading state
            btn.disabled = true;
            btn.innerHTML = '<span>&#x23F3;</span><span>Translating...</span>';

            const response = await fetch('/api/translate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    text: summary,
                    language: targetLanguage
                })
            });

            const data = await response.json();

            if (data.success) {
                const resultDiv = document.getElementById('translationResult');
                const contentDiv = document.getElementById('translatedContent');
                contentDiv.textContent = data.translated_text;
                resultDiv.style.display = 'block';

                showToast('Translation Complete', `Translated to ${targetLanguage}`, 'success');

                // Scroll to result
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } else {
                showToast('Translation Failed', data.message, 'error');
            }
        } catch (error) {
            console.error('Translation error:', error);
            showToast('Translation Failed', 'An error occurred during translation', 'error');
        } finally {
            btn.disabled = false;
            btn.innerHTML = originalHTML;
        }
    }

    // Export as TXT
    function exportAsText() {
        const transcript = document.querySelector('.transcript p').textContent;
        const summary = document.querySelector('.notes div').textContent;

        const content = `TRANSCRIPT:\n\n${transcript}\n\n\nSUMMARY:\n\n${summary}`;

        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `meeting-notes-${Date.now()}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // Export as Markdown
    function exportAsMarkdown() {
        const transcript = document.querySelector('.transcript p').textContent;
        const summary = document.querySelector('.notes div').textContent;

        const content = `# Meeting Notes\n\n## Transcript\n\n${transcript}\n\n## AI-Generated Summary\n\n${summary}`;

        const blob = new Blob([content], { type: 'text/markdown' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `meeting-notes-${Date.now()}.md`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // Copy to Clipboard
    function copyToClipboard() {
        const transcript = document.querySelector('.transcript p').textContent;
        const summary = document.querySelector('.notes div').textContent;

        const content = `TRANSCRIPT:\n\n${transcript}\n\n\nSUMMARY:\n\n${summary}`;

        navigator.clipboard.writeText(content).then(() => {
            // Show success feedback
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span>&#x2705;</span><span>Copied!</span>';
            setTimeout(() => {
                btn.innerHTML = originalText;
            }, 2000);
        }).catch(err => {
            alert('Failed to copy to clipboard');
        });
    }
</script>
{% endblock %}
